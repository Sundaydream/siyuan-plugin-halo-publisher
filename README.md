# 思源笔记 Halo 发布插件

[English](README_en_US.md) | [繁體中文](README_zh_TW.md)

<div align="center">
  <img src="./icon.png" alt="Logo" width="120" height="120">
  <h3>连接思源笔记与 Halo 博客的桥梁，为您提供无缝的写作发布体验</h3>
</div>
## ⚠️ 重要用前须知

**本插件由 AI 辅助开发，开源免费，但不对功能可用性做出任何保证，使用前及使用中请自行备份数据、自行承担风险，作者对本插件造成的任何后果不负任何责任！**

如有任何使用中遇到的问题，欢迎反馈，但是不保证修复时效（听说打赏和去 GitHub 点 Star 能加快修 Bug 哦😘）。

本插件不出意外的话在未来不会支持除 Halo 外的任何其他博客平台，有相关需求者请选用其他插件。

---

## 📖 简介

**Halo Publisher** 是一款专为思源笔记打造的发布插件，深度适配 Halo 2.0+ 博客平台。它不仅是一个简单的发布工具，更是一个完整的文章管理解决方案。通过本插件，您可以直接在思源笔记中完成文章的撰写、发布、更新以及分类管理，无需在两个平台间反复切换，让创作回归纯粹。

### 核心亮点

- **简约界面**：采用清晰明快的界面设计，操作流畅自然。
- **丰富参数**：支持文章内容、标题、元数据（Slug、摘要）等的设置。
- **图片处理**：
  - **自动图床**：自动解析并上传笔记内的本地图片到 Halo 附件库。
  - **云端兼容**：支持 Halo 的 GitHub OSS 等第三方存储插件**（部分 Halo 插件会导致无法上传图片到 Halo 本地存储库，这不是本插件的 bug ，请去对应的 Halo 插件处反馈）**。
  - **智能去重**：图片去重机制，避免重复上传。
- **隐私安全**：所有请求直接通过思源内核代理，**零第三方中转**，Token 与配置仅存储于本地。
- **数据自由**：提供完整的配置与数据导入/导出功能，方便跨设备迁移或备份。
- **多语言支持**：支持简体中文、繁体中文、英文。

---

## 用户指南

### 1. 安装与配置

#### 1.1 安装插件

在思源笔记的集市中直接搜索安装，或：

1. 下载最新的发布包 `package.zip`。
2. 打开思源笔记，进入 **设置** -> **关于**，查看 **工作空间路径**。
3. 进入工作空间目录下的 `data/plugins/`，新建文件夹 `siyuan-plugin-halo-publisher`。
4. 将压缩包解压后的所有文件放入该文件夹。
5. 重启思源笔记，在顶栏启用插件。

#### 1.2 建立连接

![image-20260115234546584](README.assets/image-20260115234546584.png)

初次使用需配置 Halo 站点信息：
1. 点击顶栏 Halo 图标，进入 **通用设置** 标签页。
2. **站点地址**：输入您的 Halo 2.x 博客地址（例如 `https://blog.example.com`）。
3. **授权认证**：
   - **自动模式（推荐）**：点击「🔐 自动登录获取 Cookie」，在弹出的内嵌窗口中登录 Halo 后台。插件会自动捕获认证信息。
   - **手动模式**：
     1. 在浏览器登录 Halo 后台。
     2. 按 `F12` 打开开发者工具 -> 网络(Network)。
     3. 刷新页面，找到任意 API 请求，复制请求头中的 `Cookie` 字段。
     4. 将其粘贴到插件的「Cookie」输入框中。
4. 点击 **保存并验证**，若显示“✅ 授权有效”，即表示连接成功。

### 2. 文章发布流程

![image-20260115234402942](README.assets/image-20260115234402942.png)

#### 2.1 准备文章
在思源笔记中完成文章撰写。

#### 2.2 发布设置
点击插件图标切换至 **文章发布** 标签页，点击获取当前笔记：
- **文章标题**：自动读取笔记标题，支持手动修改。
- **别名 (Slug)**：文章的 URL 标识。支持自动生成。
- **分类与标签**：
  - 下拉选择 Halo 中已有的分类/标签。
  - 或输入并创建新名称。
- **发布设置**：可设置是否允许评论、可见性等。

#### 2.3 执行发布
点击 **发布到 Halo** 按钮。
- **图片处理**：插件会自动扫描文内图片 -> 上传至 Halo -> 获取 URL -> 替换文内链接。
- **封面同步**：如果您在思源笔记中设置了封面，它将被自动设置为 Halo 文章封面。

### 3. 文章管理

在 **文章管理** 标签页，您可以查看所有已建立关联的文章：
- **♻️ 更新**：本地修改笔记后，点击更新可将变动同步至 Halo。
- **🔗查看**：直接打开浏览器访问博客文章。
- **🗑️ 删除**

### 4. 数据备份与迁移

为防止数据丢失或方便多设备使用，插件提供了完善的数据管理功能（位于 **通用设置** 底部）：

- **导出数据**：生成包含所有配置、发布记录（Siyuan ID ↔ Halo ID 映射）和图片缓存的 JSON 备份文件。
- **导入数据**：恢复之前的备份（注意：导入操作会覆盖当前的配置，且网站 URL 和 Cookie 不会被导入，需要重新登录）。
- **清除数据**：彻底重置插件，清除所有本地存储的配置和缓存。

---

## 🛠️ 开发者指南

本指南面向希望对插件进行二次开发或定制的高级用户。

### 技术架构

项目基于 **Vue 3 + TypeScript + Vite** 构建，采用分层架构设计，确保了代码的可维护性与扩展性。

| 模块 | 路径 | 职责说明 |
|------|------|----------|
| **UI Presentation** | `src/App.vue` | 基于 Composition API 的响应式界面，负责用户交互与状态展示。 |
| **Adaptor Layer** | `src/adaptors/` | 核心适配层。`HalowebWebAdaptor` 封装了 Halo 2.0 Open API 的所有调用细节，实现了业务逻辑与底层 API 的解耦。 |
| **Core API** | `src/api/` | 基础能力层。`BaseExtendApi` 处理底层 HTTP 请求代理、图片队列上传及错误重试机制。 |
| **State Management** | `src/utils/*Store.ts` | 本地持久化存储。包含发布记录 (`PublishStore`) 和图片缓存 (`ImageCacheStore`) 的管理，实现了数据在思源端的落地。 |

### 开发环境搭建

**前置要求**：
- Node.js 16+
- pnpm

**步骤**：
1. 克隆仓库：
   ```bash
   git clone https://github.com/YourRepo/siyuan-plugin-halo-publisher.git
   ```
2. 安装依赖：
   ```bash
   pnpm install
   ```
3. 启动开发服务器：
   ```bash
   pnpm run dev
   ```
   *注：开发模式下需手动将 `dist` 目录链接到思源插件目录。*

4. 生产构建：
   ```bash
   pnpm run build
   ```

### 调试建议
- **UI 调试**：插件 UI 本质是 WebView，可在思源笔记中通过右键 -> "Inspect" 打开开发者工具调试 Vue 组件。
- **API 调试**：查看 Console 面板的 `[HaloPublisher]` 前缀日志，可追踪详细的请求参数与响应。

---

## 📄 许可证

本项目采用 [MIT 许可证](./LICENSE) 开源。欢迎提交 Pull Request 或 Issue 参与贡献。